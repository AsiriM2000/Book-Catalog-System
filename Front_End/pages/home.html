<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" name="viewport">
    <title>Book Catalog</title>
    <!-- Bootstrap CSS -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <!----css3---->
    <link href="../assets/css/home.css" rel="stylesheet">
	<link rel="icon" type="image/png" href="../assets/img/book.png">

    <!--google fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">


    <!--google material icon-->
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">

</head>
<body>


<div class="wrapper">
    <div id="sidebar">
        <div class="sidebar-header">
            <h3><img class="img-fluid" src="../assets/img/book.png"/><span>Book Catalog</span></h3>
        </div>
        <ul class="list-unstyled component m-0">
            <li class="active">
                <a class="dashboard" href="#"><i class="material-icons">dashboard</i>dashboard </a>
            </li>
        </ul>
    </div>
    <div id="content">
        <div class="top-navbar">
            <div class="xd-topbar">
                <div class="row">
                    <div class="col-md-5 col-lg-3 order-3 order-md-2">
                        <div class="xp-searchbar">
                            <form>
                                <div class="input-group">
                                    <input class="form-control" placeholder="Search"
                                           type="search">
                                    <div class="input-group-append">
                                        <button class="btn" id="button-addon2" type="submit">Go
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!------top-navbar-end----------->


        <!------main-content-start----------->

        <div class="main-content">
			<div class="row">
                <div class="col-md-12">
                    <div class="table-wrapper">

                        <div class="table-title">
                            <div class="row">
                                <div class="col-sm-6 p-0 flex justify-content-lg-start justify-content-center">
                                    <h2 class="ml-lg-2">Manage Books</h2>
                                </div>
                            </div>
                        </div>

						<div style="margin-top: 10px">
							<form>
								<div class="row">
									<div class="col">
										<input type="text" class="form-control" placeholder="Book Id" name="id" id="id" readonly>
									</div>
									<div class="col">
										<input type="text" class="form-control" placeholder="Book Name" name="name" id="name">
									</div>

								</div>
								<div class="row" style="margin-top: 10px">
									<div class="col">
										<input type="text" class="form-control" placeholder="Category" name="category" id="category">
									</div>
									<div class="col">
										<input type="text" class="form-control" placeholder="Price" name="price" id="price">
									</div>
								</div>
                                <div class="row" style="margin-top: 10px">
                                    <div class="col">
                                        <input type="text" class="form-control" placeholder="Author" name="author" id="author">
                                    </div>
                                    <div class="col">
                                        <input type="text" class="form-control" placeholder="Qty" name="qty" id="qty">
                                    </div>
                                </div>
							</form>
							<div style="margin-top: 10px">
								<button type="button" class="btn btn-primary" id="addBook">Add Book</button>
								<button type="button" class="btn btn-danger" id="deleteBook">Delete Book</button>
								<button type="button" class="btn btn-warning" id="updateBook">Update Book</button>
                                <button type="button" class="btn btn-success" id="getBook">Get All Book</button>
							</div>
						</div>

                        <table class="table  table-hover" style="margin-top: 10px">
                            <thead class="bg-info text-white">
                            <tr>
                                <th style="width: 300px">Book Id</th>
                                <th>Book Name</th>
                                <th>Book Category</th>
                                <th>Author</th>
                                <th>Book Price</th>
                                <th>Qty</th>
                            </tr>
                            </thead>

                            <tbody id="tblBook">

                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <div class="container-fluid">
                <div class="footer-in">
                    <p class="mb-0">&copy 2023 Book Catalog. Design By : Asiri Madhusanka.</p>
                </div>
            </div>
        </footer>
    </div>
</div>

<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/jquery-3.6.1.min.js"></script>
<script>
    let baseUrl = "http://localhost:8081/book/api/v1/";

    loadAll();
    generateBookId();

    function generateBookId() {
        $("#id").empty();
        $.ajax({
            url: baseUrl + "book/generateBookId",
            dataType: "json",
            success: function (resp) {
                $("#id").val(resp.data);
            }
        });
    }

    function loadAll() {
        $("#tblBook").empty();
        $.ajax({
            url: baseUrl + "book",
            dataType: "json",
            success: function (resp) {
                for (let book of resp.data) {
                    var row = '<tr style="cursor: pointer"><td>' + book.id + '</td><td>' + book.name + '</td><td>' + book.category + '</td><td>' + book.author + '</td><td>' + book.price + '</td><td style="font-size: 16px">' + book.qty + '</td></tr>';
                    $("#tblBook").append(row);

                }
                bindRowClickEvents();
            }
        });
    }

    $("#getBook").click(function (){
        loadAll();
    });

    $("#addBook").click(function (){
        let id = $("#id").val();
        let name = $("#name").val();
        let category = $("#category").val();
        let price = $("#price").val();
        let author = $("#author").val();
        let qty = $("#qty").val();

        let data ={
            id:id,
            name:name,
            category:category,
            price:price,
            author:author,
            qty:qty
        }

        $.ajax({
            url: baseUrl+"book",
            method: "post",
            contentType: "application/json",
            data: JSON.stringify(data),
            dataType: "json",
            success:function (res){
                alert(res.message);
                loadAll();
                clear();
            },
            error: function (error){
                alert(JSON.parse(error.responseText).message);
                clear();
            }
        })
    });

    $("#updateBook").click(function (){
        let id = $("#id").val();
        let name = $("#name").val();
        let category = $("#category").val();
        let price = $("#price").val();
        let author = $("#author").val();
        let qty = $("#qty").val();

        let data ={
            id:id,
            name:name,
            category:category,
            price:price,
            author:author,
            qty:qty
        }

        $.ajax({
            url: baseUrl+"book",
            method: "put",
            contentType: "application/json",
            data: JSON.stringify(data),
            dataType: "json",
            success:function (res){
                alert(res.message);
                loadAll();
                clear();
            },
            error: function (error){
                alert(JSON.parse(error.responseText).message);
                clear();
            }
        })
    });

    $("#deleteBook").click(function (){
        let id = $("#id").val();
        $.ajax({
            url: baseUrl + "book?id=" + id,
            method: "delete",
            dataType: "json",
            success: function (resp) {
                alert(resp.message);
                loadAll();
                clear();
            },
            error: function (error) {
                alert(JSON.parse(error.responseText).message);
            }
        });
    });

    function clear(){
        $("#name").val("");
        $("#category").val("");
        $("#price").val("");
        $("#author").val("");
        $("#qty").val("");
    }
    function bindRowClickEvents() {
        $("#tblBook>tr").click(function () {
            let id = $(this).children(":eq(0)").text();
            let name = $(this).children(":eq(1)").text();
            let category = $(this).children(":eq(2)").text();
            let author = $(this).children(":eq(3)").text();
            let price = $(this).children(":eq(4)").text();
            let qty = $(this).children(":eq(5)").text();

            $('#id').val(id);
            $('#name').val(name);
            $('#category').val(category);
            $('#author').val(author);
            $('#price').val(price);
            $('#qty').val(qty);
        });
    }

</script>

</body>
</html>


